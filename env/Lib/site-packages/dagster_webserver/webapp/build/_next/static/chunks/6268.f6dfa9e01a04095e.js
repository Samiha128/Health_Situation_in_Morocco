"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6268],{38267:function(e,n,r){r.d(n,{Q1:function(){return C},Qf:function(){return b},zc:function(){return j}});var t=r(73235),u=r(52322),l=r(40794),i=r(89130),s=r(38491),o=r(39013),a=r(18149),d=r.n(a),c=r(2784),f=r(7267),h=r(35505),p=r(59351),m=r(18856),v=r(20171),x=r(34219),R=r(88610);function g(){let e=(0,t._)(["\n  query RunTabsCountQuery($queuedFilter: RunsFilter!, $inProgressFilter: RunsFilter!) {\n    queuedCount: pipelineRunsOrError(filter: $queuedFilter) {\n      ... on Runs {\n        count\n      }\n    }\n    inProgressCount: pipelineRunsOrError(filter: $inProgressFilter) {\n      ... on Runs {\n        count\n      }\n    }\n  }\n"]);return g=function(){return e},e}let y=e=>{switch(e){case"all":return"Runs | All runs";case"failed":return"Runs | Failed";case"in-progress":return"Runs | In progress";case"queued":return"Runs | Queued";case"scheduled":return"Runs | Scheduled";default:return"Runs"}},j=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,l.a)(E,{variables:{queuedFilter:{...e,statuses:Array.from(p.sy)},inProgressFilter:{...e,statuses:Array.from(p.Ys)}}});(0,x.Hu)(n,"RunTabsCountQuery");let{data:r}=n,{queuedCount:t,inProgressCount:i}=(0,c.useMemo)(()=>{var e,n;return{queuedCount:(null==r?void 0:null===(e=r.queuedCount)||void 0===e?void 0:e.__typename)==="Runs"?r.queuedCount.count:null,inProgressCount:(null==r?void 0:null===(n=r.inProgressCount)||void 0===n?void 0:n.__typename)==="Runs"?r.inProgressCount.count:null}},[r]),[o]=(0,m.oD)(),a=b(o);(0,v.j)(y(a));let d=e=>{let n=o.filter(e=>"status"!==e.token),r=e.map(e=>({token:"status",value:e}));return(0,m.it)([...r,...n])};return{tabs:(0,u.jsxs)(s.zH,{children:[(0,u.jsx)(C,{to:d([]),id:"all",$active:"all"===a,children:"All runs"}),(0,u.jsxs)(C,{to:d(Array.from(p.sy)),id:"queued",$active:"queued"===a,children:["Queued (",null!=t?t:"indeterminate",")"]}),(0,u.jsxs)(C,{to:d(Array.from(p.Ys)),id:"in-progress",$active:"in-progress"===a,children:["In progress (",null!=i?i:"indeterminate",")"]}),(0,u.jsx)(C,{to:d(Array.from(p.hd)),id:"failed",$active:"failed"===a,children:"Failed"}),(0,u.jsx)(C,{title:"Scheduled",to:"/runs/scheduled",id:"scheduled",$active:"scheduled"===a,children:"Scheduled"})]}),queryResult:n}},C=(0,h.ZP)(R.A).withConfig({componentId:"sc-1e7c25a7-0"})(["color:",";&&:hover{color:",";}",""],o.$(),o.$(),e=>{let{$active:n}=e;return n?(0,h.iv)(["background-color:",";color:",";&&:hover{background-color:",";color:",";}"],o.AU(),o.Ep(),o.AU(),o.Ep()):(0,h.iv)(["background-color:",";"],o.v8())}),b=e=>{let{pathname:n}=(0,f.TH)();if("/runs/timeline"===n)return"timeline";if("/runs/scheduled"===n)return"scheduled";if("/overview/backfills"===n)return"backfills";let r=new Set(e.filter(e=>"status"===e.token).map(e=>e.value));return d()(p.sy,r)?"queued":d()(p.Ys,r)?"in-progress":d()(p.hd,r)?"failed":"all"},E=(0,i.Ps)(g())},6268:function(e,n,r){r.r(n),r.d(n,{RUNS_ROOT_QUERY:function(){return ee},RunsRoot:function(){return G},default:function(){return K},usePaginatedRunsTableRuns:function(){return X}});var t=r(73235),u=r(52322),l=r(89130),i=r(49853),s=r(14934),o=r(49308),a=r(74580),d=r(35292),c=r(37483),f=r(89891),h=r(80122),p=r(96795),m=r.n(p),v=r(2784),x=r(40794),R=r(16629),g=r(47933),y=r(9108),j=r(35232);function C(){let e=(0,t._)(['\n  query QueueDaemonStatusQuery {\n    instance {\n      id\n      daemonHealth {\n        id\n        daemonStatus(daemonType: "QUEUED_RUN_COORDINATOR") {\n          id\n          daemonType\n          healthy\n          required\n        }\n      }\n    }\n  }\n']);return C=function(){return e},e}let b=()=>{let e=(0,j._)();return(0,u.jsxs)(s.x,{flex:{direction:"column",gap:8},style:{minWidth:"100%"},border:"bottom",children:[e&&(0,u.jsx)(R.b,{intent:"info",title:(0,u.jsx)(g.rU,{to:"/config#run_coordinator",children:"View queue configuration"})}),e&&(0,u.jsx)(E,{})]})},E=()=>{let{data:e}=(0,x.a)(_),{pageTitle:n}=(0,v.useContext)(y.N),r=null==e?void 0:e.instance.daemonHealth.daemonStatus;return(null==r?void 0:r.required)&&!(null==r?void 0:r.healthy)?(0,u.jsx)(R.b,{intent:"warning",title:"The queued run coordinator is not healthy.",description:(0,u.jsxs)("div",{children:["View ",(0,u.jsx)(g.rU,{to:"/health",children:n})," for details."]})}):null},_=(0,l.Ps)(C());var k=r(38267),q=r(59351),w=r(89010),P=r(33182),A=r(18856),T=r(56675),F=r(38491),$=r(18149),O=r.n($),Q=r(96569);function S(){let e=(0,t._)(["\n  query TerminateRunIdsQuery($filter: RunsFilter!) {\n    pipelineRunsOrError(filter: $filter) {\n      ... on Runs {\n        results {\n          id\n          status\n          canTerminate\n        }\n      }\n    }\n  }\n"]);return S=function(){return e},e}let I=e=>{let{refetch:n,filter:r,disabled:t}=e,[l,i]=(0,v.useState)(null),s=(0,T.x)(),o=async()=>{let e=await s.query({query:U,variables:{filter:r}});i("Runs"===e.data.pipelineRunsOrError.__typename?Object.fromEntries(e.data.pipelineRunsOrError.results.map(e=>[e.id,e.canTerminate])):{})};return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(Q.A,{isOpen:null!==l,selectedRuns:l||{},selectedRunsAllQueued:O()(r,{statuses:Array.from(q.sy)}),onClose:()=>i(null),onComplete:()=>n()}),(0,u.jsx)(F.zx,{intent:"danger",outlined:!0,disabled:t,onClick:o,children:"Terminate allâ€¦"})]})},U=(0,l.Ps)(S());var H=r(15332),N=r(78491),Y=r(16336),z=r(69737),D=r(28316);function L(e){let{node:n}=e,r=v.useRef(null);return v.useLayoutEffect(()=>{let e=r.current;if(n.parentNode!==e){if(null!==n.parentNode&&n.parentNode!==e)throw Error("Cannot render the same node twice");return null==e||e.appendChild(n),()=>{null==e||e.removeChild(n)}}},[n]),(0,u.jsx)("div",{ref:r})}var V=r(92322),Z=r(34219),B=r(59923),M=r(85062);function W(){let e=(0,t._)(["\n  query RunsRootQuery($limit: Int, $cursor: String, $filter: RunsFilter!) {\n    pipelineRunsOrError(limit: $limit, cursor: $cursor, filter: $filter) {\n      ... on Runs {\n        results {\n          id\n          ...RunTableRunFragment\n        }\n      }\n      ... on InvalidPipelineRunsFilterError {\n        message\n      }\n      ...PythonErrorFragment\n    }\n  }\n\n  ","\n  ","\n"]);return W=function(){return e},e}function X(e){let{queryResult:n,paginationProps:r}=(0,H.l)({nextCursorForResult:e=>{var n;if("Runs"===e.pipelineRunsOrError.__typename)return null===(n=e.pipelineRunsOrError.results[24])||void 0===n?void 0:n.id},getResultArray:e=>e&&"Runs"===e.pipelineRunsOrError.__typename?e.pipelineRunsOrError.results:[],variables:{filter:e},query:ee,pageSize:25});return{queryResult:n,paginationProps:r}}let G=()=>{(0,z.Px)();let e=(0,V.se)("RunsRoot"),[n,r]=(0,A.oD)(),t=(0,A.VH)(n),{queryResult:l,paginationProps:p}=X(t);(0,Z.Hu)(l,"RunsRootQuery");let x=(0,Y.C4)(l,Y.dT),R=(0,k.Qf)(n),g="all"!==R,[y,j]=m()(n,e=>"status"===e.token),C=(0,v.useCallback)(e=>{g?r([...y,...e]):r(e)},[r,g,y]),E=(0,v.useCallback)(e=>{let n=(0,i.HY)(e);j.some(e=>(0,i.HY)(e)===n)||C([...j,e])},[j,C]),_=(0,v.useMemo)(()=>{let e=["tag","snapshotId","id","job","pipeline","partition","backfill"];return g||e.push("status"),e},[g]),T=(0,v.useMemo)(()=>g?n.filter(e=>"status"!==e.token):n,[n,g]),{tabs:F,queryResult:$}=(0,k.zc)(t),O=(0,Y.C4)($,Y.dT),Q=(0,Y.V5)(O,x),{button:S,activeFiltersJsx:U}=(0,A.Vv)({tokens:T,onChange:C,enabledFilters:_}),[H,N]=function(e){let[n,r]=v.useState(null);return v.useLayoutEffect(()=>{r(e=>null===e?document.createElement("div"):e)},[]),[n?(0,D.createPortal)(e,n):null,n?(0,u.jsx)(L,{node:n}):null]}(S);function W(){var e,n,r,l;return(0,u.jsxs)(s.x,{style:{width:"100%",marginRight:8},flex:{justifyContent:"space-between"},children:[(0,u.jsxs)(s.x,{flex:{direction:"row",alignItems:"center",gap:8},children:[F,N]}),"queued"===R?(0,u.jsx)(I,{refetch:Q.refetch,filter:{...t,statuses:Array.from(q.sy)},disabled:(null===(e=$.data)||void 0===e?void 0:e.queuedCount.__typename)!=="Runs"||(null===(n=$.data)||void 0===n?void 0:n.queuedCount.count)===0}):"in-progress"===R?(0,u.jsx)(I,{refetch:Q.refetch,filter:{...t,statuses:Array.from(q.Ys)},disabled:(null===(r=$.data)||void 0===r?void 0:r.inProgressCount.__typename)!=="Runs"||(null===(l=$.data)||void 0===l?void 0:l.inProgressCount.count)===0}):void 0]})}return(0,u.jsxs)(o.T,{children:[(0,u.jsx)(a.m,{title:(0,u.jsx)(d.X6,{children:"Runs"}),right:(0,u.jsx)(Y.xi,{refreshState:Q})}),H,(0,u.jsx)(P.Lw.Provider,{value:{refetch:l.refetch},children:(0,u.jsx)(B.g,{queryResult:l,allowStaleData:!0,renderError:e=>{let n=!!((null==e?void 0:e.networkError)&&"statusCode"in e.networkError&&400===e.networkError.statusCode);return(0,u.jsxs)(s.x,{flex:{direction:"column",gap:32},padding:{vertical:8,left:24,right:12},children:[W(),(0,u.jsx)(c.t,{icon:"warning",title:n?"Invalid run filters":"Unexpected error",description:n?"The specified run filters are not valid. Please check the filters and try again.":"An unexpected error occurred. Check the console for details."})]})},children:n=>{let{pipelineRunsOrError:r}=n;return"Runs"!==r.__typename?(0,u.jsx)(s.x,{padding:{vertical:64},children:(0,u.jsx)(c.t,{icon:"error",title:"Query Error",description:r.message})}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(J,{trace:e}),(0,u.jsx)(M.Y,{$top:0,children:(0,u.jsx)(w.AL,{runs:r.results.slice(0,25),onAddTag:E,filter:t,actionBarComponents:W(),belowActionBarComponents:"queued"===R||U.length?(0,u.jsxs)(u.Fragment,{children:["queued"===R&&(0,u.jsx)(b,{}),U.length>0&&(0,u.jsxs)(u.Fragment,{children:[U,(0,u.jsx)(f.Z,{onClick:()=>C([]),children:"Clear all"})]})]}):null})}),r.results.length>0?(0,u.jsx)("div",{style:{marginTop:"16px"},children:(0,u.jsx)(h.pI,{...p})}):null]})}})})]})},J=e=>{let{trace:n}=e;return(0,v.useLayoutEffect)(()=>{n.endTrace()},[n]),null};var K=G;let ee=(0,l.Ps)(W(),w.ZZ,N.B)},85062:function(e,n,r){r.d(n,{Y:function(){return u}});var t=r(39013);let u=r(35505).ZP.div.withConfig({componentId:"sc-1e417a12-0"})(["thead tr{position:sticky;top:","px;background-color:",";z-index:1;}thead tr th{position:relative;}thead tr th::after{content:'';display:block;height:1px;background-color:",";position:absolute;bottom:-1px;left:0;right:0;}"],e=>{let{$top:n=0}=e;return n},t.v8(),t.wL())}}]);
//# sourceMappingURL=6268.f6dfa9e01a04095e.js.map